<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily News | Appwrite</title>
<script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --primary: #f02e65;
    --primary-dark: #d91c54;
    --secondary: #2e5bf0;
    --text-primary: #1a1a1a;
    --text-secondary: #65676b;
    --bg: #f7f7f8;
    --card: #ffffff;
    --border: #e5e7eb;
    --success: #10b981;
    --error: #ef4444;
    --warning: #f59e0b;
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
    --radius: 12px;
    --radius-sm: 8px;
}
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-primary); line-height:1.5; }

.mobile-header { display:flex; justify-content:space-between; align-items:center; padding:16px; background:var(--card); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; }
.back-button { display:flex; align-items:center; gap:8px; color:var(--text-primary); text-decoration:none; font-weight:500; }
.page-title { font-size:18px; font-weight:600; }
.container { padding:20px; max-width:1200px; margin:0 auto; }

.news-grid { display:grid; grid-template-columns:1fr; gap:20px; margin-top:20px; }
@media(min-width:768px){ .news-grid{ grid-template-columns:repeat(2,1fr); } }
@media(min-width:1024px){ .news-grid{ grid-template-columns:repeat(3,1fr); } }

.news-card { background:var(--card); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow-sm); transition: transform 0.2s ease, box-shadow 0.2s ease; display:flex; flex-direction:column; }
.news-card:hover { transform:translateY(-3px); box-shadow:var(--shadow-md); }
.news-image { width:100%; height:200px; object-fit:cover; background:#f0f0f0; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); position:relative; }
.news-image img { width:100%; height:100%; object-fit:cover; display:none; }
.image-spinner { position:absolute; width:40px; height:40px; border:4px solid rgba(0,0,0,0.1); border-top-color:var(--primary); border-radius:50%; animation:spin 1s linear infinite; }
@keyframes spin{ to{ transform:rotate(360deg); } }

.news-content { padding:20px; flex-grow:1; display:flex; flex-direction:column; }
.news-title{ font-size:18px; font-weight:600; margin-bottom:12px; color:var(--text-primary);}
.news-date{ font-size:14px; color:var(--text-secondary); margin-bottom:12px;}
.news-description{ color:var(--text-secondary); margin-bottom:15px; overflow:hidden;}
.news-description.truncated{ display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;}
.read-more{ background:none; border:none; color:var(--primary); cursor:pointer; font-weight:600; padding:0; margin-top:auto; text-align:left; }
.read-more:hover{ color:var(--primary-dark); }

.loading{ display:flex; justify-content:center; align-items:center; height:200px; flex-direction:column; gap:16px;}
.spinner{ width:40px; height:40px; border:4px solid rgba(240,46,101,0.1); border-radius:50%; border-top-color:var(--primary); animation:spin 1s linear infinite; }

.filter-section{ display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; flex-wrap:wrap; gap:16px; }
.search-box{ position:relative; flex-grow:1; }
.search-box input{ width:100%; padding:12px 16px 12px 40px; border-radius:var(--radius-sm); border:1px solid var(--border); font-size:16px; }
.search-box i{ position:absolute; left:16px; top:50%; transform:translateY(-50%); color:var(--text-secondary); }
.refresh-btn{ padding:12px 20px; background:var(--primary); color:white; border:none; border-radius:var(--radius-sm); cursor:pointer; font-weight:600; display:flex; align-items:center; gap:8px; }
.refresh-btn:hover{ background:var(--primary-dark); }

.error-message{ background:rgba(239,68,68,0.1); color:var(--error); padding:16px; border-radius:var(--radius-sm); border:1px solid rgba(239,68,68,0.2); margin-bottom:20px; display:flex; align-items:center; gap:8px; }

@media(min-width:768px){ .mobile-header{display:none;} .container{padding:24px;} }
.desktop-back{ display:none; }
@media(min-width:768px){ .desktop-back{ display:flex; align-items:center; gap:8px; margin-bottom:24px; color:var(--text-primary); text-decoration:none; font-weight:500; align-self:flex-start; } }
</style>
</head>
<body>

<div class="mobile-header">
<a href="dash.html" class="back-button"><i class="fas fa-arrow-left"></i></a>
<h1 class="page-title">Daily News</h1>
<div style="width:24px;"></div>
</div>

<div class="container">
<a href="dash.html" class="desktop-back"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
<div class="filter-section">
<div class="search-box"><i class="fas fa-search"></i><input type="text" id="searchInput" placeholder="Search news..."></div>
<button class="refresh-btn" id="refreshBtn"><i class="fas fa-sync-alt"></i> Refresh News</button>
</div>

<div id="newsContainer"><div class="loading"><div class="spinner"></div><div>Loading latest news...</div></div></div>
</div>

<script>
const RSS_FEED_URL = 'https://nagariknews.nagariknetwork.com/feed';
const newsContainer = document.getElementById('newsContainer');
const refreshBtn = document.getElementById('refreshBtn');
const searchInput = document.getElementById('searchInput');
let newsItems = [];

async function fetchNews(){
    try{
        newsContainer.innerHTML = `<div class="loading"><div class="spinner"></div><div>Loading latest news...</div></div>`;
        const url = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(RSS_FEED_URL)}`;
        const res = await fetch(url);
        if(!res.ok) throw new Error('Failed to fetch news feed');
        const data = await res.json();

        newsItems = data.items.map(item => {
            // prioritize thumbnail, then enclosure, then image in description
            let img = item.thumbnail || (item.enclosure?.link) || '';
            if(!img){
                const match = (item.description||'').match(/<img[^>]+src="([^">]+)"/);
                if(match) img = match[1];
            }
            return {
                title: item.title || 'No title',
                link: item.link || '#',
                description: item.content || item.description || 'No description',
                pubDate: item.pubDate || '',
                imageUrl: img
            };
        });

        displayNews(newsItems);
    } catch(e){
        console.error(e);
        newsContainer.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-circle"></i> Error loading news: ${e.message}</div>`;
    }
}

function displayNews(items){
    if(!items.length){
        newsContainer.innerHTML = `<div class="error-message"><i class="fas fa-info-circle"></i> No news articles found.</div>`;
        return;
    }
    newsContainer.innerHTML = `<div class="news-grid">
    ${items.map((item,index)=>`
        <div class="news-card">
            <div class="news-image">
                ${item.imageUrl ? `<div class="image-spinner"></div><img src="${item.imageUrl}" alt="${item.title}" onload="this.style.display='block'; this.previousElementSibling.style.display='none';" onerror="this.parentNode.innerHTML='<i class=\\'fas fa-image\\'></i> No image available'">` : `<i class="fas fa-image"></i> No image available`}
            </div>
            <div class="news-content">
                <h3 class="news-title">${item.title}</h3>
                <div class="news-date">${formatDate(item.pubDate)}</div>
                <div class="news-description truncated" id="desc-${index}">${item.description.replace(/<[^>]*>/g,'')}</div>
                <button class="read-more" onclick="toggleDescription(${index})">Read More</button>
            </div>
        </div>`).join('')}
    </div>`;
}

function toggleDescription(index){
    const desc = document.getElementById(`desc-${index}`);
    const btn = desc.nextElementSibling;
    if(desc.classList.contains('truncated')){
        desc.classList.remove('truncated');
        btn.textContent='Read Less';
    } else {
        desc.classList.add('truncated');
        btn.textContent='Read More';
    }
}

function formatDate(dateStr){
    if(!dateStr) return 'Date not available';
    try{return new Date(dateStr).toLocaleString('en-US',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});}catch{return dateStr;}
}

function filterNews(){
    const term = searchInput.value.toLowerCase();
    if(!term){ displayNews(newsItems); return; }
    displayNews(newsItems.filter(i=>i.title.toLowerCase().includes(term)||i.description.toLowerCase().includes(term)));
}

refreshBtn.addEventListener('click', fetchNews);
searchInput.addEventListener('input', filterNews);

fetchNews();
setInterval(fetchNews,5*60*1000);
</script>
</body>
</html>